@page "/SongDownload"
@using System.Diagnostics
@using VideoLibrary
@using System
@using System.IO
@using Xabe.FFmpeg
@inject IWebHostEnvironment Environment


<PageTitle>Index</PageTitle>
<html>
<input type="text" @bind="link" placeholder="your youtube link:">
<button @onclick="Download">
    download
</button>

@if (isDone)
{
    <h1>
        Downloaded
    </h1>
}
@videofullnewpath

</html>

@code {
    public static bool isfirst = true;
    public static bool isDone = false;
    public static string link { get; set; }
    public static string DirectorySongs { get; set; }
    public static string home { get; set; }
    public static string videoname { get; set; }
    public static string videofullpath { get; set; }
    public static string videofullnewpath { get; set; }

    public static void Download()
    {
        using (var service = Client.For(YouTube.Default))
        {
            while (isfirst)
            {
                isfirst = false;
                var video = service.GetVideo(link);
                string folder = DirectorySongs;
                string path = Path.Combine(folder, video.FullName);
                videoname = video.FullName;
                File.WriteAllBytes(path, video.GetBytes());
                isDone = true;
            }
        }
        videofullpath = Path.Combine(DirectorySongs, videoname);
        videofullnewpath = (videofullpath.Remove(videofullpath.Length - 4, 4) + ".mp3");
    }
    static void ConvertMP4ToMP3()
    {

    }

    protected override void OnInitialized()
    {
        home = Environment.ContentRootPath;
        DirectorySongs = Path.Combine(home, "wwwroot/Songs");
    }

}